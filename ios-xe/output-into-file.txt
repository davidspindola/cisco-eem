! Thu, 26 Mar 2020
!
! #output-into-file
! Sends CLI outputs into a file, the file name is based on the hostname and unix time stamp
!  * HW: ISR4321/K9
!  * SW: isr4300-universalk9.16.12.01a.SPA.bin
!
! Trigger:
!  Use the command: 'event manager run output-into-file'


event manager applet output-into-file authorization bypass

 event none maxrun 60

 action 000 info type routername
 action 001 set filename "flash:$_info_routername-$_event_pub_sec"
 action 002 syslog msg "Creating and logging data to '$filename'."
 action 003 file open FD $filename a+

 action 051 cli command "enable"
 action 052 cli command "terminal length 0"

 action 100 set counter 0

 action 200 foreach cmd "show clock,show version,show inventory" ","

 action 301 cli command $cmd
 action 302 file puts FD "------------------ $cmd ------------------"
 action 303 file puts FD "$_cli_result"
 action 304 increment counter 1
 action 305 end

 action 900 file close FD
 action 950 syslog msg "File '$filename' closed with $counter outputs logged."
 action 999 cli command "end"

end
